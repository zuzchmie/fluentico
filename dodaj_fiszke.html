<html lang="pl">

<head>
    <meta charset="UTF-8" />
    <title>Fluentico – Stwórz fiszkę</title>
    <link rel="stylesheet" href="twoje_fiszki.css" />
    <link rel="stylesheet" href="tryb_glos.css" />
</head>

<body>
<div class="main-container">
    <aside class="sidebar" id="sidebar">
        <div class="logo">
            <div class="logo-square"></div>
            <h1 class="brand-title">FLUENTICO</h1>
        </div>

        <nav class="sidebar-menu" role="navigation">
            <a href="website.html" class="menu-item" role="menuitem">
                <span class="menu-text large">EKRAN GŁÓWNY</span>
            </a>
            
            <a href="fiszki_main.html" class="menu-item selected" role="menuitem">
                <span class="menu-text large">FISZKI</span></a>
            
            <a href="quiz_dnia.html" class="menu-item" role="menuitem">
                <span class="menu-text large">QUIZ DNIA</span>
            </a>
            
            <a href="testy_main.html" class="menu-item" role="menuitem">
                <span class="menu-text large">TESTY</span>
            </a>
            
            <div class="divider"></div>
            
            <button class="menu-item settings" role="menuitem">
                <span class="menu-text large">USTAWIENIA</span>
            </button>
        </nav>
    </aside>

    <main class="content-area">
        <header class="header-section">
            <div class="header-row">
                <a href="fiszki_main.html" class="back-button">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M15 18L9 12L15 6" stroke="white" stroke-width="5" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </a>
                <h1 class="page-title">STWÓRZ FISZKĘ</h1>
            </div>
        </header>

        <section class="flashcard-voice-container">

            <input type="text" id="front-input" class="voice-option" placeholder="Dodaj przód karty *" />
            <input type="text" id="back-input" class="voice-option" placeholder="Dodaj tył karty *" />

        <!-- Przycisk Dodaj audio i Dodaj obrazek w jednej linii pod fiszką -->
            <div class="insert-buttons">
                <button class="action-button">DODAJ AUDIO</button>
                <button class="action-button" id="select-set-btn">WYBIERZ ZESTAW *</button>
                <button class="action-button">DODAJ OBRAZEK</button>
            </div>

            <!-- Dropdown menu dla zestawów (ukryty domyślnie) -->
            <div id="sets-dropdown" class="sets-dropdown" style="display: none;">
                <div id="sets-list"></div>
            </div>
            
            <!-- Tekst "Obowiązkowe" -->
            <div id="required-text" style="text-align: center; color: #000000; font-family: 'Archivo Black', Arial, sans-serif; font-size: 16px; margin-top: 0px; margin-bottom: 5px;">
                * Obowiązkowe
            </div>

            <div class="flashcard-buttons">
                <button id="save-btn" class="save-btn-disabled">UTWÓRZ</button>
            </div>
            
            <!-- Komunikat o zapisaniu -->
            <div id="save-message" class="save-message" style="display: none;">
                Utworzono Fiszkę
            </div>
            
            <!-- Komunikat o błędzie -->
            <div id="error-message" class="error-message" style="display: none;">
                Uzupełnij fiszkę oraz wybierz zestaw
            </div>
        </section>

    </main>
    
    <!-- Modal tworzenia zestawu -->
    <div id="create-set-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <h2>Utwórz Zestaw</h2>
            <input type="text" id="set-name-input" class="modal-input" placeholder="Nazwa zestawu" maxlength="50" />
            <div class="modal-buttons">
                <button class="modal-btn modal-btn-cancel" onclick="closeCreateSetModal()">Anuluj</button>
                <button class="modal-btn modal-btn-confirm" onclick="confirmCreateSet()">Utwórz</button>
            </div>
        </div>
    </div>
</div>

<!-- Dołączamy plik z danymi fiszek -->
<script src="flashcardsData.js"></script>

<script>
    // Stan aplikacji
    let selectedSet = null;

    // Elementy DOM
    const frontInput = document.getElementById('front-input');
    const backInput = document.getElementById('back-input');
    const selectSetBtn = document.getElementById('select-set-btn');
    const setsDropdown = document.getElementById('sets-dropdown');
    const setsList = document.getElementById('sets-list');
    const saveBtn = document.getElementById('save-btn');

    // Inicjalizacja — generowanie listy zestawów w dropdown
    function initializeSetsDropdown() {
        // Załaduj custom zestawy do window.flashcardsSets
        const customSets = JSON.parse(localStorage.getItem('customSets')) || [];
        customSets.forEach(setName => {
            if (!window.flashcardsSets[setName]) {
                window.flashcardsSets[setName] = {
                    icon: 'bi-bookmark',
                    cards: []
                };
            }
        });
        
        // Połącz stałe zestawy z custom zestawami
        const allSets = getAllSets().concat(customSets);
        const uniqueSets = [...new Set(allSets)];
        
        setsList.innerHTML = ''; // Wyczyszczenie poprzedniej listy
        
        // Dodaj przycisk "UTWÓRZ ZESTAW" na górze
        const createSetItem = document.createElement('div');
        createSetItem.className = 'set-item create-set-item';
        createSetItem.textContent = 'UTWÓRZ ZESTAW';
        createSetItem.addEventListener('click', () => {
            openCreateSetModal();
        });
        setsList.appendChild(createSetItem);
        
        // Dodaj separator
        const separator = document.createElement('div');
        separator.className = 'set-item-separator';
        setsList.appendChild(separator);
        
        uniqueSets.forEach(setName => {
            const setItem = document.createElement('div');
            setItem.className = 'set-item';
            setItem.textContent = setName;
            
            setItem.addEventListener('click', () => selectSet(setName));
            setsList.appendChild(setItem);
        });
    }

    // Wybór zestawu
    function selectSet(setName) {
        selectedSet = setName;
        selectSetBtn.textContent = setName;
        setsDropdown.style.display = 'none'; // Zamknięcie dropdown
        updateSaveButtonState(); // Aktualizuj stan przycisku
    }

    // Otwarcie/zamknięcie dropdown
    selectSetBtn.addEventListener('click', () => {
        const isVisible = setsDropdown.style.display === 'block';
        setsDropdown.style.display = isVisible ? 'none' : 'block';
    });

    // Zamknięcie dropdown po kliknięciu poza nim
    document.addEventListener('click', (e) => {
        if (!e.target.closest('.action-button') && !e.target.closest('.sets-dropdown')) {
            setsDropdown.style.display = 'none';
        }
    });

    // Sprawdzenie stanu pól i aktualizacja przycisku
    function updateSaveButtonState() {
        const frontText = frontInput.value.trim();
        const backText = backInput.value.trim();
        const isValid = frontText && backText && selectedSet;
        const requiredText = document.getElementById('required-text');
        
        if (isValid) {
            saveBtn.classList.remove('save-btn-disabled');
            saveBtn.classList.add('save-btn-enabled');
            requiredText.style.visibility = 'hidden'; // Ukryj tekst "* Obowiązkowe"
        } else {
            saveBtn.classList.remove('save-btn-enabled');
            saveBtn.classList.add('save-btn-disabled');
            requiredText.style.visibility = 'visible'; // Pokaż tekst "* Obowiązkowe"
        }
    }

    // Słuchaj zmian w polach input
    frontInput.addEventListener('input', updateSaveButtonState);
    backInput.addEventListener('input', updateSaveButtonState);

    // Funkcja do otwierania modala tworzenia zestawu
    function openCreateSetModal() {
        const modal = document.getElementById('create-set-modal');
        const input = document.getElementById('set-name-input');
        modal.style.display = 'flex';
        input.value = ''; // Wyczyść poprzednią wartość
        input.focus(); // Fokus na input
        setsDropdown.style.display = 'none'; // Zamknij dropdown
    }
    
    // Funkcja do zamykania modala tworzenia zestawu
    function closeCreateSetModal() {
        const modal = document.getElementById('create-set-modal');
        modal.style.display = 'none';
    }
    
    // Funkcja do potwierdzenia utworzenia zestawu
    function confirmCreateSet() {
        const input = document.getElementById('set-name-input');
        const setName = input.value.trim().toUpperCase();
        
        if (!setName) {
            alert('Proszę wpisać nazwę zestawu!');
            return;
        }
        
        // Sprawdź czy zestaw już istnieje
        const sets = getAllSets();
        if (sets.includes(setName)) {
            alert('Zestaw o tej nazwie już istnieje!');
            return;
        }
        
        // Dodaj nowy zestaw
        if (!window.flashcardsSets[setName]) {
            window.flashcardsSets[setName] = {
                icon: 'bi-bookmark',
                cards: []
            };
        }
        
        // Zapisz w localStorage
        const customSets = JSON.parse(localStorage.getItem('customSets')) || [];
        if (!customSets.includes(setName)) {
            customSets.push(setName);
            localStorage.setItem('customSets', JSON.stringify(customSets));
        }
        
        // Zamknij modal i odśwież dropdown
        closeCreateSetModal();
        initializeSetsDropdown();
        selectSet(setName); // Automatycznie wybierz nowy zestaw
    }
    
    // Obsługa Enter w input
    document.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
            const modal = document.getElementById('create-set-modal');
            if (modal.style.display === 'flex') {
                confirmCreateSet();
            }
        }
    });

    // Obsługa przycisku UTWÓRZ
    saveBtn.addEventListener('click', () => {
        const frontText = frontInput.value.trim();
        const backText = backInput.value.trim();
        const isFrontEmpty = !frontText;
        const isBackEmpty = !backText;
        const isSetNotSelected = !selectedSet;

        // Sprawdź czy którekolwiek pole jest puste
        if (isFrontEmpty || isBackEmpty || isSetNotSelected) {
            // Pokaż komunikat błędu
            const errorMessage = document.getElementById('error-message');
            errorMessage.style.display = 'block';
            errorMessage.style.animation = 'none';
            setTimeout(() => {
                errorMessage.style.animation = 'fadeInOut 3s ease-in-out';
            }, 10);
            
            // Ukryj komunikat błędu po animacji
            setTimeout(() => {
                errorMessage.style.display = 'none';
            }, 3000);
            return;
        }

        // Dodaj nową fiszkę do zestawu
        addFlashcardToSet(selectedSet, backText, frontText);

        // Wyświetl komunikat o zapisaniu
        const saveMessage = document.getElementById('save-message');
        saveMessage.style.display = 'block';
        // Resetuj animację
        saveMessage.style.animation = 'none';
        setTimeout(() => {
            saveMessage.style.animation = 'fadeInOut 3s ease-in-out';
        }, 10);
        
        // Ukryj komunikat po animacji
        setTimeout(() => {
            saveMessage.style.display = 'none';
        }, 3000);

        // Czyszczenie formularza (ale zachowaj wybrany zestaw)
        frontInput.value = '';
        backInput.value = '';
        updateSaveButtonState(); // Aktualizuj stan przycisku
    });

    // Funkcja do dodawania nowej fiszki do zestawu
    function addFlashcardToSet(setName, polish, english) {
        // Dodaj do obiektu window.flashcardsSets (w pamięci przeglądarki)
        if (window.flashcardsSets[setName]) {
            window.flashcardsSets[setName].cards.push({
                polish: polish,
                english: english
            });
        }

        // Zapisz do localStorage (zachowuje dane między sesjami)
        const customCards = JSON.parse(localStorage.getItem('customFlashcards')) || {};
        if (!customCards[setName]) {
            customCards[setName] = [];
        }
        customCards[setName].push({
            polish: polish,
            english: english
        });
        localStorage.setItem('customFlashcards', JSON.stringify(customCards));
    }

    // Załaduj custom fiszki z localStorage przy starcie
    function loadCustomFlashcards() {
        const customCards = JSON.parse(localStorage.getItem('customFlashcards')) || {};
        
        for (const setName in customCards) {
            if (window.flashcardsSets[setName]) {
                window.flashcardsSets[setName].cards.push(...customCards[setName]);
            }
        }
    }

    // Inicjalizacja przy załadowaniu strony
    document.addEventListener('DOMContentLoaded', () => {
        loadCustomFlashcards(); // Załaduj fiszki z localStorage
        initializeSetsDropdown();
    });
</script>

</body>
</html>
